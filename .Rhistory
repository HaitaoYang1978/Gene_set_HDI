if(!require(devtools)){
install.packages("devtools")
library(devtools) }
if(!require(ACAT)){
library(devtools)
devtools::install_github("yaowuliu/ACAT")
library(ACAT)
}
if(!require(screening)){
library(devtools)
devtools::install_github('wwrechard/screening')
library(screening)
}
#################### Source all de-sparsified lasso functions ####################
files.sources = list.files('./de-sparsified lasso functions')
sapply(paste0("./de-sparsified lasso functions/",files.sources), source)
#################### Generate the simulation data ####################
source('simulation_data.R')
#################### Variable screening via high dimensional ordinary least squares projection (HOLP) ####################
library(screening)
source('HOLP.R')
x=X;y=Y
G_Var=Group_test
#################### statistical inference with de-sparsified LASSO estimator ####################
fit.lasso <- lasso.proj(x, y,multiplecorr.method = 'WY',robust = TRUE)
p_value=fit.lasso$pval[Group_test]
bhat=fit.lasso$bhat[Group_test]
########### Inference under the DSSM model assumption by minimum p-value approach ###########
P_G=min(fit.lasso$pval.corr)
#################### Inference under the CWSM model assumption by iART-A ####################
source('DOT.ART.P.R') #Decorrelation by orthogonal transformation (DOT)
source('ART.A.R') #Adaptative augmented rank truncation (ART-A)
L<-length(p_value)
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy<-ACAT(P.arta)#Improved adaptative augmented rank truncation (iART-A)
#################### Omnibus test based on MinP and iART-A ####################
P.arta_Omnibus<-ACAT(c(P_G,P.arta_Cauchy))
#################### Output results into a excel file ####################
Results<-cbind(P_G,P.arta_Cauchy,P.arta_Omnibus)
write.csv(Results,paste("HOLP_HDI_Omnibus",".csv",sep = ''))
P_G P.arta_Cauchy P.arta_Omnibus
Results
setwd('E:/科研/M3800P/科研/HPCC Files/HDI-Cauchy-Omnibus/GitHub/Simulation')
n_x=600 # sample size
r_G1=0.9 # the correlation coefficient of First Order Autoregressive AR(1) for group 1(G1)
r_G2=0.9 # the correlation coefficient of First Order Autoregressive AR(1) for group 1(G2)
#################### load all the required packages ####################
if(!require(glmnet)){
install.packages("glmnet")
library(glmnet)
}
if(!require(future.apply)){
install.packages("future.apply")
library(future.apply)
}
if(!require(MASS)){
install.packages("MASS")
library(MASS)
}
if(!require(mvtnorm)){
install.packages("mvtnorm")
library(mvtnorm)
}
if(!require(devtools)){
install.packages("devtools")
library(devtools) }
if(!require(ACAT)){
library(devtools)
devtools::install_github("yaowuliu/ACAT")
library(ACAT)
}
if(!require(screening)){
library(devtools)
devtools::install_github('wwrechard/screening')
library(screening)
}
#################### Source all de-sparsified lasso functions ####################
files.sources = list.files('./de-sparsified lasso functions')
sapply(paste0("./de-sparsified lasso functions/",files.sources), source)
#################### Generate the simulation data ####################
source('simulation_data.R')
#################### Variable screening via high dimensional ordinary least squares projection (HOLP) ####################
library(screening)
source('HOLP.R')
x=X;y=Y
G_Var=Group_test
#################### statistical inference with de-sparsified LASSO estimator ####################
fit.lasso <- lasso.proj(x, y,multiplecorr.method = 'WY',robust = TRUE)
p_value=fit.lasso$pval[Group_test]
bhat=fit.lasso$bhat[Group_test]
########### Inference under the DSSM model assumption by minimum p-value approach ###########
P_G=min(fit.lasso$pval.corr)
#################### Inference under the CWSM model assumption by iART-A ####################
source('DOT.ART.P.R') #Decorrelation by orthogonal transformation (DOT)
source('ART.A.R') #Adaptative augmented rank truncation (ART-A)
L<-length(p_value)
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy<-ACAT(P.arta)#Improved adaptative augmented rank truncation (iART-A)
#################### Omnibus test based on MinP and iART-A ####################
P.arta_Omnibus<-ACAT(c(P_G,P.arta_Cauchy))
#################### Output results into a excel file ####################
Results<-cbind(P_G,P.arta_Cauchy,P.arta_Omnibus)
write.csv(Results,paste("HOLP_HDI_Omnibus",".csv",sep = ''))
Results
#P_G P.arta_Cauchy P.arta_Omnibus
#[1,] 0.0532     0.7882996      0.1292347
setwd("E:/科研/M3800P/科研/SCI/HOLP-HDI-Omnibus/To cui/GitHub/Gene_set_HDI")
#setwd('~./Gene_set_HDI/')
gg=2 # set the random seed.
#################### load all the required packages ####################
if(!require(glmnet)){
install.packages("glmnet")
library(glmnet)
}
if(!require(future.apply)){
install.packages("future.apply")
library(future.apply)
}
if(!require(MASS)){
install.packages("MASS")
library(MASS)
}
if(!require(mvtnorm)){
install.packages("mvtnorm")
library(mvtnorm)
}
if(!require(devtools)){
install.packages("devtools")
library(devtools) }
library(screening)
library(ACAT)
files.sources = list.files('./de-sparsified lasso functions')
sapply(paste0("./de-sparsified lasso functions/",files.sources), source)
source('Example_data.R')
source('Gene_set_HDI.R')
getwd()
source('Gene_set_HDI_function.R')
#################### Output results into a excel file ####################
Results<-cbind(p_value,P_G,P.arta_Cauchy,P.arta_Omnibus)
source('Example_data.R')
source('Gene_set_HDI_function.R')
Gene_set_HDI(X,Y,b=2)
source('Example_data.R')
source('Gene_set_HDI_function.R')
Gene_set_HDI(X,Y,b=2)
source('Example_data.R')
source('Gene_set_HDI_function.R')
Gene_set_HDI(X,Y,b=2)
c('p_value')
source('Example_data.R')
source('Gene_set_HDI_function.R')
Gene_set_HDI(X,Y,b=2)
Gene_test<-Gene_set_HDI(X,Y,b=2)
Gene_test$`iART-A`
source('Example_data.R')
source('Gene_set_HDI_function.R')
Gene_set_HDI(X,Y,G_N_1=168,G_N_2=823,b=2)
Gene_set_HDI(X,Y,G_N_1=168,G_N_2=823,b=1)
# read the example data
example.data<-readRDS('example.data.RDS')
X<-example.data[,-dim(example.data)[2]]
Y<-example.data[,dim(example.data)[2]]
X[1:5,1:10]
colnames(X)
colnames(X)[1:168]
total_SNP_name<-colnames(X)
gene1_name<-colnames(X)[1:168]
dim(X)
total_SNP_name<-colnames(X)
gene1_name<-colnames(X)[1:168]
gene2_name<-colnames(X)[169:991]
G1_location<-which(total_SNP_name %in% gene1_name)
G2_location<-which(total_snp_name %in% gene2_name)
G2_location<-which(total_SNP_name %in% gene2_name)
G1_location
G2_location
1:G_N_1
G_Var<-c(G1_location,G2_location)
G_Var
G_Var<-list(G1_location,G2_location)
G_Var
#setwd('~./Gene_set_HDI/')
gg=2 # set the random seed.
#################### load all the required packages ####################
if(!require(glmnet)){
install.packages("glmnet")
library(glmnet)
}
if(!require(future.apply)){
install.packages("future.apply")
library(future.apply)
}
if(!require(MASS)){
install.packages("MASS")
library(MASS)
}
if(!require(mvtnorm)){
install.packages("mvtnorm")
library(mvtnorm)
}
if(!require(devtools)){
install.packages("devtools")
library(devtools) }
#################### Source all de-sparsified lasso functions ####################
files.sources = list.files('./de-sparsified lasso functions')
sapply(paste0("./de-sparsified lasso functions/",files.sources), source)
library(screening)
library(ACAT)
example.data<-readRDS('example.data.RDS')
X<-example.data[,-dim(example.data)[2]]
Y<-example.data[,dim(example.data)[2]]
n_x<-nrow(X)
total_SNP_name<-colnames(X)
gene1_name<-colnames(X)[1:168]
gene2_name<-colnames(X)[169:991]
G1_location<-which(total_SNP_name %in% gene1_name)
G2_location<-which(total_SNP_name %in% gene2_name)
G_Var<-list(G1_location,G2_location)
G_Var
library(screening)
set.seed(gg)
train_id<-sample(1:n_x, n_x*0.5)
d=floor(dim(X[train_id,])[1]/log(dim(X[train_id,])[1]))
model11=screening(X[train_id,], Y[train_id], method = "holp", num.select =d,family = "gaussian", ebic = FALSE)
s0<-sort(model11$screen)
Xt<-X[-train_id,]
Yt<-Y[-train_id]
X<-Xt[,s0]
Y<-Yt
s0
x=X;y=Y
fit.lasso <- lasso.proj(x, y,multiplecorr.method = 'WY',robust = TRUE)
fit.lasso$pval
gene1_name
which(names(fit.lasso$pval) %in% gene1_name)
which(names(fit.lasso$pval) %in% gene2_name)
#b=1 # b=1:test the gene 1; b=2: test the gene 2
#if (b==1){
#  Group_test=G_1_s0 # G_1_s0: the location of gene 1 after variable screening
#}
#if (b==2){
# Group_test=G_2_s0 # G_2_s0: the location of gene 2 after variable screening
#}
G_Var=list()
G_Var[1]<-which(names(fit.lasso$pval) %in% gene1_name)
G_Var[2]<-which(names(fit.lasso$pval) %in% gene2_name)
G_Var
which(names(fit.lasso$pval) %in% gene1_name)
G_Var[[1]]<-which(names(fit.lasso$pval) %in% gene1_name)
G_Var[[2]]<-which(names(fit.lasso$pval) %in% gene2_name)
G_Var
1:length(G_Var)
p_value<-c()
P_G<-c()
P.arta_Cauchy<-c()
P.arta_Omnibus<-c()
Results<-list()
i=1
G_Var[[i]]
p_value[i]=fit.lasso$pval[G_Var[[i]]] # the p-values of all SNPs within the gene to be tested.
fit.lasso$pval
fit.lasso$pval[G_Var[[i]]]
p_value<-list()
p_value[i]=fit.lasso$pval[G_Var[[i]]] # the p-values of all SNPs within the gene to be tested.
p_value[[i]]=fit.lasso$pval[G_Var[[i]]] # the p-values of all SNPs within the gene to be tested.
p_value
bhat=fit.lasso$bhat[G_Var[[i]]]
cov_G=fit.lasso$beta.cov[G_Var[[i]],G_Var[[i]]]
P_G[i]=min(p.adjust.wy(cov=cov_G, pval=p_value))
P_G[i]=min(p.adjust.wy(cov=cov_G, pval=p_value[[i]]))
P_G
source('DOT.ART.P.R',local = TRUE) #Decorrelation by orthogonal transformation (DOT)
source('DOT.ART.P.R',local = TRUE) #Decorrelation by orthogonal transformation (DOT)
source('ART.A.R',local = TRUE) #Adaptative augmented rank truncation (ART-A)
#################### Improved adaptative augmented rank truncation (iART-A) ####################
L<-length(p_value[[i]])
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy[i]<-ACAT(P.arta)
P.arta_Cauchy<-ACAT(P.arta)
d<-L-1
P.arta_Cauchy[i]<-ifelse(P.arta_Cauchy==1,P.arta_Cauchy<-1-1/d,P.arta_Cauchy)#replace 1 by 1-1/d, where d is the number of p-values combined by ACAT
P.arta_Cauchy
P.arta_Omnibus[i]<-ACAT(c(P_G,P.arta_Cauchy))
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
Results[i]<-list(p_value,P_G,P.arta_Cauchy,P.arta_Omnibus)
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
Results[i]<-list(p_value[[i]],P_G,P.arta_Cauchy,P.arta_Omnibus)
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
Results[[i]]<-list(p_value[[i]],P_G,P.arta_Cauchy,P.arta_Omnibus)
Results
names(Results)[[1]]<-c('p_value')
names(Results)[[2]]<-c('MinP')
names(Results)[i][[1]]<-c('p_value')
names(Results)[i][[2]]<-c('MinP')
names(Results)[i][[3]]<-c('iART-A')
names(Results)[i][[4]]<-c('Min-O')
names(Results[i])
names(Results)
Results<-list()
names(Results)
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
Results[[i]]<-list(p_value[[i]],P_G,P.arta_Cauchy,P.arta_Omnibus)
Results
names(Results)
Results[1]
Results[1][[1]]
Results[1][1]
Results[1][1][[1]][[1]]
Results[1][[1]][[1]]
names(Results[1][[1]][[1]])<-c('p_value')
Results
p_value<-list()
P_G<-c()
P.arta_Cauchy<-c()
P.arta_Omnibus<-c()
Results<-list()
for (i in 1:length(G_Var)) {
p_value[[i]]=fit.lasso$pval[G_Var[[i]]] # the p-values of all SNPs within the gene to be tested.
bhat=fit.lasso$bhat[G_Var[[i]]]
########### Inference under the DSSM model assumption by minimum p-value approach ###########
cov_G=fit.lasso$beta.cov[G_Var[[i]],G_Var[[i]]]
P_G[i]=min(p.adjust.wy(cov=cov_G, pval=p_value[[i]]))
#################### Inference under the CWSM model assumption by iART-A ####################
source('DOT.ART.P.R',local = TRUE) #Decorrelation by orthogonal transformation (DOT)
source('ART.A.R',local = TRUE) #Adaptative augmented rank truncation (ART-A)
#################### Improved adaptative augmented rank truncation (iART-A) ####################
L<-length(p_value[[i]])
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy<-ACAT(P.arta)
d<-L-1
P.arta_Cauchy[i]<-ifelse(P.arta_Cauchy==1,P.arta_Cauchy<-1-1/d,P.arta_Cauchy)#replace 1 by 1-1/d, where d is the number of p-values combined by ACAT
#################### Omnibus test based on MinP and iART-A ####################
P.arta_Omnibus[i]<-ACAT(c(P_G,P.arta_Cauchy))
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
}
p_value
P_G
P.arta_Cauchy
P.arta_Omnibus
i
#################### Improved adaptative augmented rank truncation (iART-A) ####################
L<-length(p_value[[i]])
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta
P.arta_Cauchy<-ACAT(P.arta)
d<-L-1
ifelse(P.arta_Cauchy==1,P.arta_Cauchy<-1-1/d,P.arta_Cauchy)
i=1
L<-length(p_value[[i]])
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy<-ACAT(P.arta)
d<-L-1
ifelse(P.arta_Cauchy==1,P.arta_Cauchy<-1-1/d,P.arta_Cauchy)
P.arta_Cauchy
p_value<-list()
P_G<-c()
P.arta_Cauchy<-c()
P.arta_Omnibus<-c()
Results<-list()
for (i in 1:length(G_Var)) {
p_value[[i]]=fit.lasso$pval[G_Var[[i]]] # the p-values of all SNPs within the gene to be tested.
bhat=fit.lasso$bhat[G_Var[[i]]]
########### Inference under the DSSM model assumption by minimum p-value approach ###########
cov_G=fit.lasso$beta.cov[G_Var[[i]],G_Var[[i]]]
P_G[i]=min(p.adjust.wy(cov=cov_G, pval=p_value[[i]]))
#################### Inference under the CWSM model assumption by iART-A ####################
source('DOT.ART.P.R',local = TRUE) #Decorrelation by orthogonal transformation (DOT)
source('ART.A.R',local = TRUE) #Adaptative augmented rank truncation (ART-A)
#################### Improved adaptative augmented rank truncation (iART-A) ####################
L<-length(p_value[[i]])
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy<-ACAT(P.arta)
d<-L-1
P.arta_Cauchy[i]<-ifelse(P.arta_Cauchy==1,P.arta_Cauchy<-1-1/d,P.arta_Cauchy)#replace 1 by 1-1/d, where d is the number of p-values combined by ACAT
#################### Omnibus test based on MinP and iART-A ####################
P.arta_Omnibus[i]<-ACAT(c(P_G,P.arta_Cauchy))
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
}
P.arta_Cauchy
p_value<-list()
P_G<-c()
P.arta_Cauchy<-c()
P.arta_Omnibus<-c()
Results<-list()
for (i in 1:length(G_Var)) {
p_value[[i]]=fit.lasso$pval[G_Var[[i]]] # the p-values of all SNPs within the gene to be tested.
bhat=fit.lasso$bhat[G_Var[[i]]]
########### Inference under the DSSM model assumption by minimum p-value approach ###########
cov_G=fit.lasso$beta.cov[G_Var[[i]],G_Var[[i]]]
P_G[i]=min(p.adjust.wy(cov=cov_G, pval=p_value[[i]]))
#################### Inference under the CWSM model assumption by iART-A ####################
source('DOT.ART.P.R',local = TRUE) #Decorrelation by orthogonal transformation (DOT)
source('ART.A.R',local = TRUE) #Adaptative augmented rank truncation (ART-A)
#################### Improved adaptative augmented rank truncation (iART-A) ####################
L<-length(p_value[[i]])
k1 <- 2
k2 <-L
P.arta<-c()
for ( k in k1:k2){
P.arta[which(k== k1:k2)]<- ART.A(P, k, L)[1]
}
P.arta_Cauchy[i]<-ACAT(P.arta)
d<-L-1
P.arta_Cauchy[i]<-ifelse(P.arta_Cauchy[i]==1,P.arta_Cauchy[i]<-1-1/d,P.arta_Cauchy[i])#replace 1 by 1-1/d, where d is the number of p-values combined by ACAT
#################### Omnibus test based on MinP and iART-A ####################
P.arta_Omnibus[i]<-ACAT(c(P_G,P.arta_Cauchy))
#################### Output results into a exceldata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWElEQVR42mNgGPTAxsZmJsVqQApgmGw1yApwKcQiT7phRBuCzzCSDSHGMKINIeDNmWQlA2IigKJwIssQkHdINgxfmBBtGDEBS3KCxBc7pMQgMYE5c/AXPwAwSX4lV3pTWwAAAABJRU5ErkJggg== file ####################
}
P.arta_Cauchy
P.arta_Omnibus
P_G
p_value
names(p_value)
names(p_value)[1]<-'gene1'
p_value
names(p_value)<-c('gene1','gene2')
p_value
names(P_G)<-c('gene1','gene2')
P_G
names(P.arta_Cauchy)<-c('gene1','gene2')
names(P.arta_Omnibus)<-c('gene1','gene2')
P.arta_Cauchy
P.arta_Omnibus
Results<-list(p_value,P_G,P.arta_Cauchy,P.arta_Omnibus)
Results
names(Results)[1]<-c('p_value')
Results
names(Results)[2]<-c('MinP')
names(Results)[3]<-c('iART-A')
names(Results)[4]<-c('Min-O')
Results
names(Results)[3]<-c('iART_A')
names(Results)[4]<-c('Min_O')
Results
Results
Results$p_value
#setwd('~./Gene_set_HDI/')
gg=2 # set the random seed.
#################### load all the required packages ####################
if(!require(glmnet)){
install.packages("glmnet")
library(glmnet)
}
if(!require(future.apply)){
install.packages("future.apply")
library(future.apply)
}
if(!require(MASS)){
install.packages("MASS")
library(MASS)
}
if(!require(mvtnorm)){
install.packages("mvtnorm")
library(mvtnorm)
}
if(!require(devtools)){
install.packages("devtools")
library(devtools) }
library(screening)
library(ACAT)
#################### Source all de-sparsified lasso functions ####################
files.sources = list.files('./de-sparsified lasso functions')
sapply(paste0("./de-sparsified lasso functions/",files.sources), source)
source('Example_data.R')
#################### locate the genes ####################
total_SNP_name<-colnames(X)
gene1_name<-colnames(X)[1:168]
gene2_name<-colnames(X)[169:991]
G1_location<-which(total_SNP_name %in% gene1_name)
G2_location<-which(total_SNP_name %in% gene2_name)
G_Var<-list(G1_location,G2_location)
G_Var
names(G_Var)<-c('gene1','gene2')
G_Var
#################### testing the genes  ####################
source('Gene_set_HDI_function.R')
Gene_set_HDI(X,Y,G_Var=G_var)
